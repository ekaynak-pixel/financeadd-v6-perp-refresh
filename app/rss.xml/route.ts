import {NextResponse} from 'next/server';import {getDB} from '../../lib/db';export const runtime='nodejs';function esc(s:string){return s.replace(/[<>&'"]/g,c=>({'<':'&lt;','>':'&gt;','&':'&amp;',"'":'&apos;','"':'&quot;'} as any)[c])}export async function GET(){const base=process.env.SITE_URL||'https://financeadd.com';const db=getDB();const posts=db.prepare('SELECT slug,title,created_at FROM posts ORDER BY created_at DESC LIMIT 50').all();const items=posts.map((p:any)=>`<item><title>${esc(p.title)}</title><link>${base}/blog/${p.slug}</link><guid>${base}/blog/${p.slug}</guid><pubDate>${new Date(p.created_at).toUTCString()}</pubDate><description>${esc('Auto-generated finance page')}</description></item>`).join('\n');const xml=`<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"><channel><title>FinanceAdd Blog</title><link>${base}</link><description>AI-generated finance articles</description>${items}</channel></rss>`;return new NextResponse(xml,{headers:{'Content-Type':'application/rss+xml'}})}
