import {NextRequest,NextResponse} from 'next/server';import {getDB} from '../../../../../lib/db';export const runtime='nodejs';
export async function POST(req:NextRequest){const {id,label,base_url,model,header_name,api_key,enabled,priority}=await req.json();const db=getDB();const pid=id||(globalThis.crypto?.randomUUID?.()||String(Math.random()));db.prepare(`INSERT INTO api_keys (id,label,base_url,model,header_name,api_key,enabled,priority) VALUES (?,?,?,?,?,?,?,?) ON CONFLICT(id) DO UPDATE SET label=excluded.label,base_url=excluded.base_url,model=excluded.model,header_name=excluded.header_name,api_key=excluded.api_key,enabled=excluded.enabled,priority=excluded.priority`).run(pid,label,base_url,model,header_name,api_key,enabled?1:0,(priority ?? 10));return NextResponse.json({ok:true,id:pid})}
