import Link from 'next/link';import CSEBlock from '../../../components/CSEBlock';import UnifiedWebResults from '../../../components/UnifiedWebResults';import {insertSearchTerm,ensureBlogStubForTerm} from '../../../lib/db';import {pingIndexNow} from '../../../lib/indexnow';
export const dynamic='force-dynamic';
async function AIBlock({term}:{term:string}){const r=await fetch(`${process.env.SITE_URL||'https://financeadd.com'}/api/ask`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:`Answer the question: "${term}". Cite reputable sources.`})});const data=await r.json();const text=(data.text||'').replace(/\n/g,'<br/>');if(!text) return <div className="small">AI offline: Showing Google results only.</div>;return <div dangerouslySetInnerHTML={{__html:text}} />}
export default async function QueryPage({params}:{params:{term:string}}){const term=decodeURIComponent(params.term);insertSearchTerm(term,Number(process.env.MAX_SEARCH_ROWS||20000));const slug=ensureBlogStubForTerm(term,Number(process.env.MAX_POSTS||2000));pingIndexNow([`${process.env.SITE_URL||'https://financeadd.com'}/q/${encodeURIComponent(term)}`,`${process.env.SITE_URL||'https://financeadd.com'}/blog/${slug}`]).catch(()=>{});
return(<div className="grid gap-6"><div className="card"><h1 className="text-2xl font-semibold mb-1">Search: {term}</h1><div className="small">Google results first, then AI and web.</div></div><div className="card"><div className="badge mb-2">Google results</div><CSEBlock query={term} resultsOnly /></div><div className="card"><div className="badge mb-2">AI answer</div><AIBlock term={term} /></div><div className="card"><div className="badge mb-2">Suggested web articles</div><UnifiedWebResults term={term} /></div><div className="card small"><Link className="link" href={`/blog/${slug}`}>View auto blog page â†’</Link></div></div>)}
